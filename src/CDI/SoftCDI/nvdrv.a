	nam nvdrv
	use c:\DEFS\OSKDEFS.D
	use macros.m

typelang	equ	(Drivr<<8)+Objct
attrrevs	equ	((ReEnt+SupStat)<<8)+$99
edition		equ	0
stacksize	equ	0
entrypt		equ	EntryTable

	psect nvdrv,typelang,attrrevs,edition,stacksize,entrypt

* TODO: write a custom NVRAM manager in C++?

EntryTable	dc.w	Init
			dc.w	Read
			dc.w	Write
			dc.w	GetStat
			dc.w	SetStat
			dc.w	Term
			dc.w	0	Trap handler

Init
	softcdi
	eor.w d0,d0
	rts

Read
	trap #2
	eor.w d0,d0
	rts

Write
	trap #3
	eor.w d0,d0
	rts

GetStat
	trap #4
	eor.w d0,d0
	rts

SetStat
	trap #5
	eor.w d0,d0
	rts

Term
	trap #6
	eor.w d0,d0
	rts

	vsect
* The kernel needs a non-zero static storage space, or it fails to attach with E$NoRAM.
* Original nvdrv has a size of $A0.
	ds.w $50
	ends

	ends
